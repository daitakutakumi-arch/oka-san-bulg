<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>お母さんのブログ（オフライン編集版）</title>
  <meta name="description" content="温かいカフェ風、お母さんのブログ（オフライン編集版）。ブラウザ上で記事・写真・コメントを追加・編集・削除できます。">
  <style>
    :root{
      --accent:#c76b4f;
      --bg:#fef5ef;
      --card:#fff8f0;
      --text:#3c2f2f;
      --shadow:0 4px 16px rgba(0,0,0,0.08);
    }
    body{font-family:'Shadows Into Light', cursive,'Noto Sans JP', sans-serif;background:var(--bg);color:var(--text);line-height:1.7;margin:0;}
    header{background:linear-gradient(90deg,#ffe5d0,#fcd9b8);padding:30px;text-align:center;box-shadow:var(--shadow);}
    header h1{font-size:2rem;margin:0;color:var(--accent);}
    main{max-width:800px;margin:40px auto;padding:0 20px;display:grid;gap:30px;}
    article{background:var(--card);padding:24px;border-radius:16px;box-shadow:var(--shadow);position:relative;}
    article h2{color:var(--accent);margin-bottom:10px;font-size:1.4rem;}
    article time{display:block;color:#7a5a48;font-size:0.85rem;margin-bottom:12px;}
    article img{width:100%;border-radius:10px;margin:10px 0;}
    .gallery-slider{position:relative;overflow:hidden;border-radius:12px;margin-top:12px;}
    .gallery-slider img{width:100%;height:300px;object-fit:cover;display:none;}
    .gallery-slider img.active{display:block;}
    .comment-section{margin-top:20px;}
    .comment-section h3{margin-bottom:10px;color:var(--accent);}
    .comment-list{margin-bottom:10px;}
    .comment{background:#fff3f3;padding:10px;border-radius:8px;margin-bottom:8px;position:relative;}
    .comment small{color:#7a5a48;display:block;margin-top:4px;}
    .delete-btn{position:absolute;top:6px;right:6px;background:var(--accent);border:none;color:white;padding:2px 6px;border-radius:4px;cursor:pointer;font-size:0.7rem;}
    .comment-form textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;resize:none;}
    .comment-form button{margin-top:6px;background:var(--accent);color:white;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;}
    .comment-form button:hover{opacity:0.9;}
    .edit-btn,.del-article-btn{position:absolute;top:10px;right:60px;background:#ffa07a;border:none;color:white;padding:4px 8px;border-radius:6px;cursor:pointer;font-size:0.75rem;}
    .del-article-btn{right:10px;background:#c76b4f;}
    footer{text-align:center;padding:24px;color:#7a5a48;font-size:0.9rem;}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:1000;}
    .lightbox.open{display:flex;}
    .lightbox img{max-width:90%;max-height:90%;border-radius:10px;}
    #new-post{background:var(--card);padding:24px;border-radius:16px;box-shadow:var(--shadow);margin-bottom:40px;}
    #new-post input,#new-post textarea{width:100%;margin-bottom:10px;padding:10px;border-radius:8px;border:1px solid #ddd;}
    #new-post button{background:var(--accent);color:white;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;}
  </style>
</head>
<body>
<header>
  <h1>お母さんのブログ（オフライン編集版）</h1>
</header>
<main>
  <div id="new-post">
    <h2>新しい記事を追加</h2>
    <input type="text" id="new-title" placeholder="タイトル">
    <textarea id="new-text" placeholder="本文"></textarea>
    <input type="text" id="new-images" placeholder="写真URL（カンマ区切り）">
    <button id="add-post">記事を追加</button>
  </div>
  <div id="blog-container"></div>
</main>
<footer>© <span id="year"></span> お母さんのブログ — 温かいカフェ風（オフライン編集）</footer>
<div id="lightbox" class="lightbox" onclick="closeLightbox(event)"><img id="lightbox-img" src="" alt="拡大画像"></div>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  const STORAGE_KEY = 'okaasan_blog_posts';
  let posts = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

  function savePosts(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(posts)); }

  function renderPosts(){
    const container = document.getElementById('blog-container');
    container.innerHTML='';
    posts.forEach((post,i)=>{
      const article = document.createElement('article');
      article.innerHTML = `<h2>${post.title}</h2><time>${new Date(post.date).toLocaleDateString()}</time><p>${post.text}</p>`;
      if(post.images){
        article.innerHTML += `<div class='gallery-slider'>${post.images.map((src,j)=>`<img src='${src}' class='${j===0?'active':''}' onclick='openLightbox(this)'>`).join('')}</div>`;
      }
      article.innerHTML += `<button class='edit-btn' data-id='${i}'>編集</button><button class='del-article-btn' data-id='${i}'>削除</button>`;
      article.innerHTML += `<div class='comment-section'><h3>コメント</h3><div class='comment-list' id='comments-${i}'></div><div class='comment-form'><textarea placeholder='コメントを書く...'></textarea><button data-post='${i}'>投稿</button></div></div>`;
      container.appendChild(article);
      renderComments(i);
    });
    startSliders();
  }

  function renderComments(postId){
    const list = document.getElementById('comments-'+postId);
    const post = posts[postId];
    list.innerHTML='';
    post.comments = post.comments || [];
    post.comments.forEach((c,j)=>{
      const div = document.createElement('div');
      div.className='comment';
      div.innerHTML=`${c.name||'匿名'}: ${c.text}<small>${new Date(c.date).toLocaleString()}</small>`;
      const btn = document.createElement('button'); btn.textContent='削除'; btn.className='delete-btn';
      btn.onclick=()=>{post.comments.splice(j,1);savePosts();renderComments(postId);};
      div.appendChild(btn);
      list.appendChild(div);
    });
  }

  document.addEventListener('click', e=>{
    if(e.target.id==='add-post'){
      const title = document.getElementById('new-title').value.trim();
      const text = document.getElementById('new-text').value.trim();
      const images = document.getElementById('new-images').value.split(',').map(s=>s.trim()).filter(Boolean);
      if(!title || !text) return;
      posts.push({title,text,images,date:new Date().toISOString(),comments:[]});
      savePosts();
      document.getElementById('new-title').value='';
      document.getElementById('new-text').value='';
      document.getElementById('new-images').value='';
      renderPosts();
    }
    if(e.target.classList.contains('edit-btn')){
      const i = e.target.getAttribute('data-id');
      const post = posts[i];
      const newTitle = prompt('タイトルを編集', post.title);
      const newText = prompt('本文を編集', post.text);
      const newImages = prompt('写真URL（カンマ区切り）', post.images.join(','));
      if(newTitle && newText){
        post.title = newTitle;
        post.text = newText;
        post.images = newImages.split(',').map(s=>s.trim()).filter(Boolean);
        savePosts();
        renderPosts();
      }
    }
    if(e.target.classList.contains('del-article-btn')){
      const i = e.target.getAttribute('data-id');
      if(confirm('この記事を削除しますか？')){
        posts.splice(i,1);
        savePosts();
        renderPosts();
      }
    }
    if(e.target.tagName==='BUTTON' && e.target.parentElement.classList.contains('comment-form')){
      const btn = e.target;
      const textarea = btn.previousElementSibling;
      const text = textarea.value.trim();
      if(!text) return;
      const postId = btn.getAttribute('data-post');
      posts[postId].comments.push({text,name:'',date:new Date().toISOString()});
      savePosts();
      textarea.value='';
      renderComments(postId);
    }
  });

  function startSliders(){
    document.querySelectorAll('.gallery-slider').forEach(slider=>{
      let imgs = slider.querySelectorAll('img');
      let idx=0;
      setInterval(()=>{
        imgs[idx].classList.remove('active');
        idx = (idx+1)%imgs.length;
        imgs[idx].classList.add('active');
      },4000);
    });
  }

  function openLightbox(img){
    const lb=document.getElementById('lightbox');
    const lbImg=document.getElementById('lightbox-img');
    lbImg.src=img.src;
    lb.classList.add('open');
  }
  function closeLightbox(e){
    if(e.target.id==='lightbox' || e.target.id==='lightbox-img'){
      document.getElementById('lightbox').classList.remove('open');
    }
  }

  renderPosts();
</script>
</body>
</html>
